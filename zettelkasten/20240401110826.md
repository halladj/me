# Creating a network bridge:

Using a qemu virtual machine that was created feels just like using any other physical machine unitl it's time for remote access , or doing any networking related activities( ports, IP address, etc... ). then you reliaze that it is connected using NAT. meaning you do not have access to the machine, can't ssh into it, or connect into any of its ports.


# Now What to do:

Generallay speaking there are two way we could achive connectivity between the host mahcine and the guest virtual machine, the first approach is using **Port-Forwarding**, which gives us the ability to make a mapping between *a port on the guest machine* to a *port on the host machine*. Whereas the other solutiobn is attching the guest machine to a **Bridge Network**, making the host and guest machines fully connected.

### Port-forwarding:

port-forwarding is a more restrected approach, because it requires the need to comfigure or map every pair of ports manually, but it might be all one needs in some sinarios for example, needing to expose one port to text a web-service, or expose a database. 

Using ***quickemu*** makes creating those mappings (port-forwarding) trivial, all we need to do is add a single line to the configuration file which could be found inside the virtual machine directory under the name `PATH_TO_VM/<VM_NAME>.conf` , for example:
```
#!/usr/bin/quickemu --vm
guest_os="macos"
disk_img="macos-ventura/disk.qcow2"
img="macos-ventura/RecoveryImage.img"
macos_release="ventura"

# here >>
port_forwards=("8081:80")
```
in the above example the port 80 on the guest is mapped to the port 8081 on the host.


### Bridge Network

Unlike port-forwarding, there is a requirement to use the bridge method. It nessicites the exictance of an Ethernet connection(Port), and there is a work-around this requirements, if like my case your machines does not have a physical Ethernet port and you mainly use WIFI. All we need to do is *connect a mobile phone to the machine using USB-type A or a TYPE-C and have thetering activated*. following these steps should Create a bridge-network and attach it to a VM:


1. [optional] **Add an Ethernet port using mobile phone**:

as you could see here, im using WIFI so there is no Etherenet port when runnig `ip -br a`:
{{< figure src="/images/posrt-13/eth1.png" title="No Etherenet" >}}

now after activating thetering on the phone and connecting it using *USB*.

{{< figure src="/images/posrt-13/eth2.png" title="Etherenet" >}}

2. now just edit the following script as follows:

```
#! /usr/bin/bash
sudo brctl addbr virtbr0
sudo brctl addif virtbr0 enp0s20f0u1c4i2

sudo ip addr add << NETWORK_MASK > dev virtbr0

sudo ip link set virtbr0 up

sudo iptables -I FORWARD -m physdev --physdev-is-bridged -j ACCEPT
```

now just replace the NETWORK_MASK with your network mask, which could be found in:

{{< figure src="/images/posrt-13/eth.png" title="Network Mask" >}}

and finally make the script an executable by running  `chmod +x script.sh`, now run it at last `./script.sh`.

3. Attach the virtual machine to the bridge network, by editing the config file.

add the following line to the end of the config file.

```
network="virtbr0"
```

## for more details

to have more insight about the whole thing from using *quickemu*, and created bridge network, to creating react-native ios developemnt builds on linux following me on instagram where i will soon sharing some toturail videos. 
